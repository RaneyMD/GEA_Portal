<!doctype html>
<html id="mdhtml">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, minimal-ui">
    <meta http-equiv="X-UA-Compatible" content="IE=9">
    <title>Markdown preview</title>
    <style>body {
  box-sizing: border-box;
  min-width: 200px;
  max-width: 980px;
  margin: 0 auto;
  padding: 45px;
}

@font-face {
  font-family: octicons-link;
  src: url(data:font/woff;charset=utf-8;base64,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) format('woff');
}

.markdown-body {
  -ms-text-size-adjust: 100%;
  -webkit-text-size-adjust: 100%;
  line-height: 1.5;
  color: #24292e;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
  font-size: 16px;
  line-height: 1.5;
  word-wrap: break-word;
}

.markdown-body .pl-c {
  color: #6a737d;
}

.markdown-body .pl-c1,
.markdown-body .pl-s .pl-v {
  color: #005cc5;
}

.markdown-body .pl-e,
.markdown-body .pl-en {
  color: #6f42c1;
}

.markdown-body .pl-smi,
.markdown-body .pl-s .pl-s1 {
  color: #24292e;
}

.markdown-body .pl-ent {
  color: #22863a;
}

.markdown-body .pl-k {
  color: #d73a49;
}

.markdown-body .pl-s,
.markdown-body .pl-pds,
.markdown-body .pl-s .pl-pse .pl-s1,
.markdown-body .pl-sr,
.markdown-body .pl-sr .pl-cce,
.markdown-body .pl-sr .pl-sre,
.markdown-body .pl-sr .pl-sra {
  color: #032f62;
}

.markdown-body .pl-v,
.markdown-body .pl-smw {
  color: #e36209;
}

.markdown-body .pl-bu {
  color: #b31d28;
}

.markdown-body .pl-ii {
  color: #fafbfc;
  background-color: #b31d28;
}

.markdown-body .pl-c2 {
  color: #fafbfc;
  background-color: #d73a49;
}

.markdown-body .pl-c2::before {
  content: "^M";
}

.markdown-body .pl-sr .pl-cce {
  font-weight: bold;
  color: #22863a;
}

.markdown-body .pl-ml {
  color: #735c0f;
}

.markdown-body .pl-mh,
.markdown-body .pl-mh .pl-en,
.markdown-body .pl-ms {
  font-weight: bold;
  color: #005cc5;
}

.markdown-body .pl-mi {
  font-style: italic;
  color: #24292e;
}

.markdown-body .pl-mb {
  font-weight: bold;
  color: #24292e;
}

.markdown-body .pl-md {
  color: #b31d28;
  background-color: #ffeef0;
}

.markdown-body .pl-mi1 {
  color: #22863a;
  background-color: #f0fff4;
}

.markdown-body .pl-mc {
  color: #e36209;
  background-color: #ffebda;
}

.markdown-body .pl-mi2 {
  color: #f6f8fa;
  background-color: #005cc5;
}

.markdown-body .pl-mdr {
  font-weight: bold;
  color: #6f42c1;
}

.markdown-body .pl-ba {
  color: #586069;
}

.markdown-body .pl-sg {
  color: #959da5;
}

.markdown-body .pl-corl {
  text-decoration: underline;
  color: #032f62;
}

.markdown-body .octicon {
  display: inline-block;
  vertical-align: text-top;
  fill: currentColor;
}

.markdown-body a {
  background-color: transparent;
}

.markdown-body a:active,
.markdown-body a:hover {
  outline-width: 0;
}

.markdown-body h1 {
  font-size: 2em;
  margin: 0.67em 0;
}

.markdown-body img {
  border-style: none;
}

.markdown-body code,
.markdown-body kbd,
.markdown-body pre {
  font-family: monospace, monospace;
  font-size: 1em;
}

.markdown-body hr {
  box-sizing: content-box;
  height: 0;
  overflow: visible;
}

.markdown-body input {
  font: inherit;
  margin: 0;
}

.markdown-body input {
  overflow: visible;
}

.markdown-body [type="checkbox"] {
  box-sizing: border-box;
  padding: 0;
}

.markdown-body * {
  box-sizing: border-box;
}

.markdown-body input {
  font-family: inherit;
  font-size: inherit;
  line-height: inherit;
}

.markdown-body a {
  color: #0366d6;
  text-decoration: none;
}

.markdown-body a:hover {
  text-decoration: underline;
}

.markdown-body strong {
  font-weight: 700;
}

.markdown-body hr {
  height: 0;
  margin: 15px 0;
  overflow: hidden;
  background: transparent;
  border: 0;
  border-bottom: 1px solid #dfe2e5;
}

.markdown-body hr::before {
  display: table;
  content: "";
}

.markdown-body hr::after {
  display: table;
  clear: both;
  content: "";
}

.markdown-body table {
  border-spacing: 0;
  border-collapse: collapse;
}

.markdown-body td,
.markdown-body th {
  padding: 0;
}

.markdown-body h1,
.markdown-body h2,
.markdown-body h3,
.markdown-body h4,
.markdown-body h5,
.markdown-body h6 {
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body h1 {
  font-size: 32px;
  font-weight: 600;
}

.markdown-body h2 {
  font-size: 24px;
  font-weight: 600;
}

.markdown-body h3 {
  font-size: 20px;
  font-weight: 600;
}

.markdown-body h4 {
  font-size: 16px;
  font-weight: 600;
}

.markdown-body h5 {
  font-size: 14px;
  font-weight: 600;
}

.markdown-body h6 {
  font-size: 12px;
  font-weight: 600;
}

.markdown-body p {
  margin-top: 0;
  margin-bottom: 10px;
}

.markdown-body blockquote {
  margin: 0;
}

.markdown-body ul,
.markdown-body ol {
  padding-left: 0;
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body ol ol,
.markdown-body ul ol {
  list-style-type: lower-roman;
}

.markdown-body ul ul ol,
.markdown-body ul ol ol,
.markdown-body ol ul ol,
.markdown-body ol ol ol {
  list-style-type: lower-alpha;
}

.markdown-body dd {
  margin-left: 0;
}

.markdown-body code {
  font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace;
  font-size: 12px;
}

.markdown-body pre {
  margin-top: 0;
  margin-bottom: 0;
  font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace;
  font-size: 12px;
}

.markdown-body .octicon {
  vertical-align: text-bottom;
}

.markdown-body .pl-0 {
  padding-left: 0 !important;
}

.markdown-body .pl-1 {
  padding-left: 4px !important;
}

.markdown-body .pl-2 {
  padding-left: 8px !important;
}

.markdown-body .pl-3 {
  padding-left: 16px !important;
}

.markdown-body .pl-4 {
  padding-left: 24px !important;
}

.markdown-body .pl-5 {
  padding-left: 32px !important;
}

.markdown-body .pl-6 {
  padding-left: 40px !important;
}

.markdown-body::before {
  display: table;
  content: "";
}

.markdown-body::after {
  display: table;
  clear: both;
  content: "";
}

.markdown-body>*:first-child {
  margin-top: 0 !important;
}

.markdown-body>*:last-child {
  margin-bottom: 0 !important;
}

.markdown-body a:not([href]) {
  color: inherit;
  text-decoration: none;
}

.markdown-body .anchor {
  float: left;
  padding-right: 4px;
  margin-left: -20px;
  line-height: 1;
}

.markdown-body .anchor:focus {
  outline: none;
}

.markdown-body p,
.markdown-body blockquote,
.markdown-body ul,
.markdown-body ol,
.markdown-body dl,
.markdown-body table,
.markdown-body pre {
  margin-top: 0;
  margin-bottom: 16px;
}

.markdown-body hr {
  height: 1px;
  padding: 0;
  margin: 24px 0;
  background-color: #d5d5d6;
  border: 0;
}

.markdown-body blockquote {
  padding: 0 1em;
  color: #6a737d;
  border-left: 0.25em solid #dfe2e5;
  font-style: italic;
}

.markdown-body blockquote>:first-child {
  margin-top: 0;
}

.markdown-body blockquote>:last-child {
  margin-bottom: 0;
}

.markdown-body kbd {
  display: inline-block;
  padding: 3px 5px;
  font-size: 11px;
  line-height: 10px;
  color: #444d56;
  vertical-align: middle;
  background-color: #fafbfc;
  border: solid 1px #c6cbd1;
  border-bottom-color: #959da5;
  border-radius: 3px;
  box-shadow: inset 0 -1px 0 #959da5;
}

.markdown-body h1,
.markdown-body h2,
.markdown-body h3,
.markdown-body h4,
.markdown-body h5,
.markdown-body h6 {
  margin-top: 24px;
  margin-bottom: 16px;
  font-weight: 600;
  line-height: 1.25;
}

.markdown-body h1 .octicon-link,
.markdown-body h2 .octicon-link,
.markdown-body h3 .octicon-link,
.markdown-body h4 .octicon-link,
.markdown-body h5 .octicon-link,
.markdown-body h6 .octicon-link {
  color: #1b1f23;
  vertical-align: middle;
  visibility: hidden;
}

.markdown-body h1:hover .anchor,
.markdown-body h2:hover .anchor,
.markdown-body h3:hover .anchor,
.markdown-body h4:hover .anchor,
.markdown-body h5:hover .anchor,
.markdown-body h6:hover .anchor {
  text-decoration: none;
}

.markdown-body h1:hover .anchor .octicon-link,
.markdown-body h2:hover .anchor .octicon-link,
.markdown-body h3:hover .anchor .octicon-link,
.markdown-body h4:hover .anchor .octicon-link,
.markdown-body h5:hover .anchor .octicon-link,
.markdown-body h6:hover .anchor .octicon-link {
  visibility: visible;
}

.markdown-body h1 {
  padding-bottom: 0.3em;
  font-size: 2em;
  border-bottom: 1px solid #eaecef;
}

.markdown-body h2 {
  padding-bottom: 0.3em;
  font-size: 1.5em;
  border-bottom: 1px solid #eaecef;
}

.markdown-body h3 {
  font-size: 1.25em;
}

.markdown-body h4 {
  font-size: 1em;
}

.markdown-body h5 {
  font-size: 0.875em;
}

.markdown-body h6 {
  font-size: 0.85em;
  color: #6a737d;
}

.markdown-body ul,
.markdown-body ol {
  padding-left: 2em;
}

.markdown-body ul ul,
.markdown-body ul ol,
.markdown-body ol ol,
.markdown-body ol ul {
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body li {
  word-wrap: break-all;
}

.markdown-body li>p {
  margin-top: 16px;
}

.markdown-body li+li {
  margin-top: 0.25em;
}

.markdown-body dl {
  padding: 0;
}

.markdown-body dl dt {
  padding: 0;
  margin-top: 16px;
  font-size: 1em;
  font-style: italic;
  font-weight: 600;
}

.markdown-body dl dd {
  padding: 0 16px;
  margin-bottom: 16px;
}

.markdown-body table {
  display: block;
  overflow: auto;
}

.markdown-body table th {
  font-weight: 600;
}

.markdown-body table th,
.markdown-body table td {
  padding: 6px 13px;
  border: 1px solid #dfe2e5;
}

.markdown-body table tr {
  background-color: #fff;
  border-top: 1px solid #c6cbd1;
}

.markdown-body table tr:nth-child(2n) {
  background-color: #f6f8fa;
}

.markdown-body img {
  max-width: 100%;
  box-sizing: content-box;
  background-color: #fff;
}

.markdown-body img[align=right] {
  padding-left: 20px;
}

.markdown-body img[align=left] {
  padding-right: 20px;
}

.markdown-body code {
  padding: 0.2em 0.4em;
  margin: 0;
  font-size: 85%;
  background-color: #f1f1f1;
  border: 1px solid #cecece;
  border-radius: 3px;
}

.markdown-body pre {
  word-wrap: normal;
}

.markdown-body pre>code {
  padding: 0;
  margin: 0;
  font-size: 100%;
  word-break: normal;
  white-space: pre;
  background: transparent;
  border: 0;
}

.markdown-body .highlight {
  margin-bottom: 16px;
}

.markdown-body .highlight pre {
  margin-bottom: 0;
  word-break: normal;
}

.markdown-body .highlight pre,
.markdown-body pre {
  padding: 16px;
  overflow: auto;
  font-size: 85%;
  line-height: 1.45;
  background-color: #f1f1f1;
  border: 1px solid #cecece;
  border-radius: 3px;
}

.markdown-body pre code {
  display: inline;
  max-width: auto;
  padding: 0;
  margin: 0;
  overflow: visible;
  line-height: inherit;
  word-wrap: normal;
  background-color: transparent;
  border: 0;
}

.markdown-body .full-commit .btn-outline:not(:disabled):hover {
  color: #005cc5;
  border-color: #005cc5;
}

.markdown-body kbd {
  display: inline-block;
  padding: 3px 5px;
  font: 11px "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace;
  line-height: 10px;
  color: #444d56;
  vertical-align: middle;
  background-color: #fafbfc;
  border: solid 1px #d1d5da;
  border-bottom-color: #c6cbd1;
  border-radius: 3px;
  box-shadow: inset 0 -1px 0 #c6cbd1;
}

.markdown-body :checked+.radio-label {
  position: relative;
  z-index: 1;
  border-color: #0366d6;
}

.markdown-body .task-list-item {
  list-style-type: none;
}

.markdown-body .task-list-item+.task-list-item {
  margin-top: 3px;
}

.markdown-body .task-list-item input {
  margin: 0 0.2em 0.25em -1.6em;
  vertical-align: middle;
}

.markdown-body hr {
  border-bottom-color: #eee;
}</style>
  </head>
  <body>
    <article class="markdown-body">
      <h1 data-sourcepos="1:1-1:11">CLAUDE.md</h1>
<p data-sourcepos="3:1-3:102">This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.</p>
<h2 data-sourcepos="5:1-5:19">Project Overview</h2>
<p data-sourcepos="7:1-7:116"><strong>GEA Management System</strong> is a Google Apps Script web application for the Gaborone Employee Association. It manages:</p>
<ul data-sourcepos="8:1-13:0">
<li data-sourcepos="8:1-8:40">Member directory and household records</li>
<li data-sourcepos="9:1-9:52">Facility reservations (tennis courts, Leobo venue)</li>
<li data-sourcepos="10:1-10:44">Payment tracking and membership activation</li>
<li data-sourcepos="11:1-11:41">Email notifications and automated tasks</li>
<li data-sourcepos="12:1-13:0">Board/admin operations</li>
</ul>
<p data-sourcepos="14:1-14:223">The system is built entirely on <strong>Google Sheets</strong> (4 spreadsheets) as the database, with a <strong>Google Apps Script</strong> backend serving a web portal (Portal.html) for members and an admin interface (Admin.html) for board members.</p>
<h2 data-sourcepos="16:1-16:24">Architecture Overview</h2>
<h3 data-sourcepos="18:1-18:19">Core Components</h3>
<ol data-sourcepos="20:1-82:0">
<li data-sourcepos="20:1-27:0">
<p data-sourcepos="20:4-20:69"><strong>Config.gs</strong> — Single source of truth for all system constants:</p>
<ul data-sourcepos="21:4-27:0">
<li data-sourcepos="21:4-21:27">Spreadsheet/folder IDs</li>
<li data-sourcepos="22:4-22:41">Brand colors, logos, email addresses</li>
<li data-sourcepos="23:4-23:76">Business rules (age thresholds, facility limits, membership categories)</li>
<li data-sourcepos="24:4-24:40">Payment methods and account details</li>
<li data-sourcepos="25:4-25:46">Error messages and audit log action types</li>
<li data-sourcepos="26:4-27:0">All configurable values should go here</li>
</ul>
</li>
<li data-sourcepos="28:1-33:0">
<p data-sourcepos="28:4-28:51"><strong>Code.gs</strong> — Web app entry point and routing:</p>
<ul data-sourcepos="29:4-33:0">
<li data-sourcepos="29:4-29:76"><code>doGet(e)</code> — Receives all HTTP requests, routes by <code>action</code> parameter</li>
<li data-sourcepos="30:4-30:97">~13 handler functions for different API endpoints (login, dashboard, book reservation, etc.)</li>
<li data-sourcepos="31:4-31:115">Routes split into: PUBLIC (login/serve), MEMBER (dashboard/profile/reservations), and BOARD (admin operations)</li>
<li data-sourcepos="32:4-33:0">Returns JSON responses via <code>ContentService</code></li>
</ul>
</li>
<li data-sourcepos="34:1-39:0">
<p data-sourcepos="34:4-34:62"><strong>AuthService.gs</strong> — Authentication &amp; session management:</p>
<ul data-sourcepos="35:4-39:0">
<li data-sourcepos="35:4-35:77"><code>login(email, password)</code> — Verifies credentials, creates session token</li>
<li data-sourcepos="36:4-36:91"><code>validateSession(token)</code> — Checks if token is valid and not expired (sliding window)</li>
<li data-sourcepos="37:4-37:73">Role checking: <code>isBoard()</code>, <code>isMember()</code>, <code>requireAuth(token, role)</code></li>
<li data-sourcepos="38:4-39:0">Session tokens stored in &quot;Sessions&quot; tab with 24-hour expiry</li>
</ul>
</li>
<li data-sourcepos="40:1-44:0">
<p data-sourcepos="40:4-40:93"><strong>MemberService.gs</strong> — Member data CRUD (only file that touches Member Directory sheet):</p>
<ul data-sourcepos="41:4-44:0">
<li data-sourcepos="41:4-41:85">Member lookups: <code>getMemberByEmail()</code>, <code>getMemberById()</code>, <code>getHouseholdMembers()</code></li>
<li data-sourcepos="42:4-42:89">Access checks: <code>isActiveMember()</code>, <code>canAccessUnaccompanied()</code>, <code>isFitnessEligible()</code></li>
<li data-sourcepos="43:4-44:0">Nightly checks: <code>checkBirthdays()</code>, <code>checkExpiringMemberships()</code>, <code>checkExpiringDocuments()</code></li>
</ul>
</li>
<li data-sourcepos="45:1-49:0">
<p data-sourcepos="45:4-45:64"><strong>ReservationService.gs</strong> — Reservations &amp; facility limits:</p>
<ul data-sourcepos="46:4-49:0">
<li data-sourcepos="46:4-46:75">Limit checking: <code>getTennisHoursThisWeek()</code>, <code>checkReservationLimits()</code></li>
<li data-sourcepos="47:4-47:105">Lifecycle: <code>createReservation()</code>, <code>approveReservation()</code>, <code>denyReservation()</code>, <code>cancelReservation()</code></li>
<li data-sourcepos="48:4-49:0">Nightly tasks: <code>processBumpWindowExpirations()</code>, <code>sendGuestListReminders()</code>, <code>sendRsoDailySummary()</code></li>
</ul>
</li>
<li data-sourcepos="50:1-54:0">
<p data-sourcepos="50:4-50:45"><strong>EmailService.gs</strong> — All email sending:</p>
<ul data-sourcepos="51:4-54:0">
<li data-sourcepos="51:4-51:116"><code>sendEmail(templateId, recipient, variables)</code> — Fetches template, replaces {{PLACEHOLDERS}}, sends HTML email</li>
<li data-sourcepos="52:4-52:85"><code>replacePlaceholders()</code> — Handles conditional blocks ({{IF_VAR}}...{{END_IF}})</li>
<li data-sourcepos="53:4-54:0"><code>buildHtmlEmail()</code> — Wraps content in GEA master template with header/footer/branding</li>
</ul>
</li>
<li data-sourcepos="55:1-59:0">
<p data-sourcepos="55:4-55:65"><strong>NotificationService.gs</strong> — Scheduled trigger entry points:</p>
<ul data-sourcepos="56:4-59:0">
<li data-sourcepos="56:4-56:121"><code>runNightlyTasks()</code> — Master function (2:00 AM): membership checks, guest reminders, bump windows, photo reminders</li>
<li data-sourcepos="57:4-57:77"><code>triggerRsoDailySummary()</code> — 6:00 AM: sends reservation summary to RSO</li>
<li data-sourcepos="58:4-59:0"><code>syncHouseholdPhonesFromPrimary()</code> — Nightly: syncs Primary member phone to Household fields</li>
</ul>
</li>
<li data-sourcepos="60:1-65:0">
<p data-sourcepos="60:4-60:85"><strong>Utilities.gs</strong> — General helpers (date, phone, ID, validation, audit logging):</p>
<ul data-sourcepos="61:4-65:0">
<li data-sourcepos="61:4-61:96">Date/business day logic: <code>calculateBusinessDayDeadline()</code>, <code>isBusinessDay()</code>, <code>isHoliday()</code></li>
<li data-sourcepos="62:4-62:95">Phone formatting: <code>formatPhoneNumber()</code>, <code>isValidPhoneNumber()</code>, <code>countryCodeToDialCode()</code></li>
<li data-sourcepos="63:4-63:71">ID generation: <code>generateId(prefix)</code> → &quot;PREFIX-YEAR-RANDOMNUMBER&quot;</li>
<li data-sourcepos="64:4-65:0">Audit logging: <code>logAuditEntry()</code> (failures logged to console, never thrown)</li>
</ul>
</li>
<li data-sourcepos="66:1-70:0">
<p data-sourcepos="66:4-66:62"><strong>Tests.gs</strong> — Test suite (no test runner, run manually):</p>
<ul data-sourcepos="67:4-70:0">
<li data-sourcepos="67:4-67:60"><code>runAllTests()</code> — Runs 10 test functions sequentially</li>
<li data-sourcepos="68:4-68:94">Tests config, utilities, holidays, email templates, member lookups, access checks, limits</li>
<li data-sourcepos="69:4-70:0">Helper: <code>_assert(label, condition, actual)</code> — Logs PASS/FAIL</li>
</ul>
</li>
<li data-sourcepos="71:1-77:0">
<p data-sourcepos="71:5-71:48"><strong>Portal.html</strong> — Member-facing interface:</p>
<ul data-sourcepos="72:5-77:0">
<li data-sourcepos="72:5-72:48">Login overlay, authenticated content below</li>
<li data-sourcepos="73:5-73:71">Pages: Dashboard, Reservations, Profile, Membership Card, Payment</li>
<li data-sourcepos="74:5-74:47">Uses sessionStorage for token persistence</li>
<li data-sourcepos="75:5-75:68"><code>apiCall(action, params)</code> — Generic fetch wrapper to backend</li>
<li data-sourcepos="76:5-77:0"><strong>Known issues</strong>: Phone number integration incomplete (initPhoneInputs not called), Guest list not implemented</li>
</ul>
</li>
<li data-sourcepos="78:1-82:0">
<p data-sourcepos="78:5-78:46"><strong>Admin.html</strong> — Board-facing interface:</p>
<ul data-sourcepos="79:5-82:0">
<li data-sourcepos="79:5-79:63">Similar structure to Portal.html but for board operations</li>
<li data-sourcepos="80:5-80:78">Pages: Dashboard (stub), Pending Reservations, Members, Photos, Payments</li>
<li data-sourcepos="81:5-82:0"><strong>Known issues</strong>: 80% of UI is structural but non-functional (shows placeholders), PORTAL_API_URL hardcoded instead of injected</li>
</ul>
</li>
</ol>
<h3 data-sourcepos="83:1-83:14">Data Model</h3>
<p data-sourcepos="85:1-85:32">The system uses 4 Google Sheets:</p>
<ol data-sourcepos="86:1-90:0">
<li data-sourcepos="86:1-86:74"><strong>GEA Member Directory</strong> — Households, Individuals, Membership Levels</li>
<li data-sourcepos="87:1-87:69"><strong>GEA Reservations</strong> — Reservations, Guest Lists, Usage Tracking</li>
<li data-sourcepos="88:1-88:40"><strong>GEA Payment Tracking</strong> — Payments</li>
<li data-sourcepos="89:1-90:0"><strong>GEA System Backend</strong> — Configuration, Sessions, Audit Log, Holiday Calendar, Email Templates, Pending Approvals</li>
</ol>
<p data-sourcepos="91:1-91:110">Key schema: Households (1:N) → Individuals, Households (1:N) → Reservations, Households (1:N) → Payments</p>
<h2 data-sourcepos="93:1-93:23">Development Commands</h2>
<h3 data-sourcepos="95:1-95:17">Running Tests</h3>
<p data-sourcepos="97:1-97:37">In the <strong>Google Apps Script editor</strong>:</p>
<pre data-sourcepos="98:1-104:3"><code class="language-javascript">runAllTests()  // Runs all 10 tests
testConfig()   // Tests spreadsheet connectivity and constants
testMemberLookup()  // Tests member/household lookups
testReservationLimits()  // Tests weekly tennis and monthly leobo limits
testSendEmail()  // Sends real test email (requires TEST_RECIPIENT config)
</code></pre>
<h3 data-sourcepos="106:1-106:21">Deploying Changes</h3>
<ol data-sourcepos="108:1-112:0">
<li data-sourcepos="108:1-108:38">Edit code in the Apps Script editor</li>
<li data-sourcepos="109:1-109:24">Save (Ctrl+S / Cmd+S)</li>
<li data-sourcepos="110:1-110:80">No build step required — changes take effect immediately for new executions</li>
<li data-sourcepos="111:1-112:0">For deployed web app, redeploy after major changes: <strong>Deploy &gt; Deploy New Version</strong></li>
</ol>
<h3 data-sourcepos="113:1-113:16">Viewing Logs</h3>
<p data-sourcepos="115:1-115:68">In the <strong>Google Apps Script editor</strong> → <strong>Executions</strong> tab to view:</p>
<ul data-sourcepos="116:1-119:0">
<li data-sourcepos="116:1-116:23">Function call history</li>
<li data-sourcepos="117:1-117:39">Errors and logs (from <code>Logger.log()</code>)</li>
<li data-sourcepos="118:1-119:0">Execution duration</li>
</ul>
<h3 data-sourcepos="120:1-120:37">Manually Triggering Nightly Tasks</h3>
<p data-sourcepos="122:1-122:22">For testing/debugging:</p>
<pre data-sourcepos="123:1-127:3"><code class="language-javascript">runNightlyTasks()  // Runs all nightly checks at once
testAllTriggers()  // Runs all trigger functions manually
testRsoSummary()   // Sends RSO summary for today
</code></pre>
<h2 data-sourcepos="129:1-129:30">Code Patterns &amp; Conventions</h2>
<h3 data-sourcepos="131:1-131:18">Error Handling</h3>
<ul data-sourcepos="133:1-150:0">
<li data-sourcepos="133:1-136:5"><strong>No try-catch for expected errors</strong> — Use validation checks instead:
<pre data-sourcepos="134:3-136:5"><code class="language-javascript">if (!member) return errorResponse(ERR_NOT_MEMBER, &quot;NOT_FOUND&quot;);
</code></pre>
</li>
<li data-sourcepos="137:1-145:5"><strong>Try-catch only for unexpected failures</strong> (I/O, Google API calls):
<pre data-sourcepos="138:3-145:5"><code class="language-javascript">try {
  var sheet = SpreadsheetApp.openById(MEMBER_DIRECTORY_ID).getSheetByName(TAB_HOUSEHOLDS);
} catch (err) {
  Logger.log(&quot;ERROR: &quot; + err);
  return errorResponse(&quot;Could not load members.&quot;, &quot;READ_FAILED&quot;);
}
</code></pre>
</li>
<li data-sourcepos="146:1-150:0"><strong>Audit log failures never thrown</strong> — logged to console only:
<pre data-sourcepos="147:3-149:5"><code class="language-javascript">logAuditEntry(email, action, type, id, details);  // Failures logged, never thrown
</code></pre>
</li>
</ul>
<h3 data-sourcepos="151:1-151:19">Response Format</h3>
<p data-sourcepos="153:1-153:75">All API endpoints return JSON via <code>successResponse()</code> or <code>errorResponse()</code>:</p>
<pre data-sourcepos="154:1-160:3"><code class="language-javascript">successResponse({ key: value }, &quot;Optional message&quot;)
// Returns: { success: true, message: &quot;...&quot;, data: {...} }

errorResponse(&quot;User-facing message&quot;, &quot;ERROR_CODE&quot;)
// Returns: { success: false, message: &quot;...&quot;, code: &quot;ERROR_CODE&quot; }
</code></pre>
<h3 data-sourcepos="162:1-162:28">Row-to-Object Conversion</h3>
<p data-sourcepos="164:1-164:58">All sheet data read as 2D arrays and converted via helper:</p>
<pre data-sourcepos="165:1-167:3"><code class="language-javascript">var row = rowToObject(headers, data[i]);  // Returns { column_name: value, ... }
</code></pre>
<h3 data-sourcepos="169:1-169:24">Phone Number Storage</h3>
<p data-sourcepos="171:1-171:41">Three-field model (not formatted string):</p>
<ul data-sourcepos="172:1-175:0">
<li data-sourcepos="172:1-172:48"><code>country_code</code> — ISO code (BW, US, GB, etc.)</li>
<li data-sourcepos="173:1-173:44"><code>phone_number</code> — Numeric only (71234567)</li>
<li data-sourcepos="174:1-175:0"><code>phone_whatsapp</code> — Boolean</li>
</ul>
<p data-sourcepos="176:1-176:73">Retrieved via <code>formatPhoneNumber(countryCode, phone)</code> → &quot;+267 71234567&quot;</p>
<h3 data-sourcepos="178:1-178:17">Audit Logging</h3>
<p data-sourcepos="180:1-180:47">Log all user actions (required for compliance):</p>
<pre data-sourcepos="181:1-184:3"><code class="language-javascript">logAuditEntry(auth.session.email, AUDIT_MEMBER_UPDATED, &quot;Individual&quot;, memberId,
              &quot;Updated phone numbers: +267 71234567&quot;);
</code></pre>
<h2 data-sourcepos="186:1-186:33">Important Configuration Points</h2>
<h3 data-sourcepos="188:1-188:26">Editing Business Rules</h3>
<p data-sourcepos="190:1-190:51">Most business rules are in <strong>Config.gs</strong>. Examples:</p>
<ul data-sourcepos="191:1-194:0">
<li data-sourcepos="191:1-191:72">Tennis limits: <code>TENNIS_WEEKLY_LIMIT_HOURS</code>, <code>TENNIS_SESSION_MAX_HOURS</code></li>
<li data-sourcepos="192:1-192:58">Age thresholds: <code>AGE_UNACCOMPANIED_ACCESS</code>, <code>AGE_VOTING</code></li>
<li data-sourcepos="193:1-194:0">Facility approval requirements: <code>FACILITIES_REQUIRING_APPROVAL</code></li>
</ul>
<p data-sourcepos="195:1-195:62">Changes take effect immediately; no code recompilation needed.</p>
<h3 data-sourcepos="197:1-197:28">Adding New API Endpoints</h3>
<ol data-sourcepos="199:1-203:0">
<li data-sourcepos="199:1-199:56">Add handler function <code>_handleNewAction(p)</code> in Code.gs</li>
<li data-sourcepos="200:1-200:48">Add case in <code>_routeAction()</code> switch statement</li>
<li data-sourcepos="201:1-201:54">Verify auth via <code>requireAuth(p.token)</code> if protected</li>
<li data-sourcepos="202:1-203:0">Return <code>successResponse()</code> or <code>errorResponse()</code></li>
</ol>
<h3 data-sourcepos="204:1-204:30">Adding New Email Templates</h3>
<ol data-sourcepos="206:1-210:0">
<li data-sourcepos="206:1-206:57">Add row to &quot;Email Templates&quot; tab in GEA System Backend</li>
<li data-sourcepos="207:1-207:28">Use template ID <code>tpl_NNN</code></li>
<li data-sourcepos="208:1-208:53">Subject and body support {{VARIABLE}} placeholders</li>
<li data-sourcepos="209:1-210:0">Call: <code>sendEmail(&quot;tpl_NNN&quot;, recipient, { VAR: value, ... })</code></li>
</ol>
<h3 data-sourcepos="211:1-211:28">Updating Spreadsheet IDs</h3>
<p data-sourcepos="213:1-213:43">After copying a spreadsheet or moving data:</p>
<ol data-sourcepos="214:1-217:0">
<li data-sourcepos="214:1-214:34">Get new ID from spreadsheet URL</li>
<li data-sourcepos="215:1-215:71">Update in <strong>Config.gs</strong> (MEMBER_DIRECTORY_ID, RESERVATIONS_ID, etc.)</li>
<li data-sourcepos="216:1-217:0">Save and run <code>runAllTests()</code> to verify connectivity</li>
</ol>
<h2 data-sourcepos="218:1-218:19">Testing Workflow</h2>
<ol data-sourcepos="220:1-224:0">
<li data-sourcepos="220:1-220:71"><strong>Unit tests</strong> — Run individual test functions for isolated checks</li>
<li data-sourcepos="221:1-221:83"><strong>Integration tests</strong> — <code>runAllTests()</code> checks end-to-end flows with real data</li>
<li data-sourcepos="222:1-222:73"><strong>Manual testing</strong> — Use Portal.html / Admin.html locally to test UI</li>
<li data-sourcepos="223:1-224:0"><strong>Production data</strong> — Test data exists (HSH-2026-TEST01) but should be deleted before production go-live</li>
</ol>
<p data-sourcepos="225:1-225:77">Test data is in Households/Individuals sheets with IDs starting with <code>-TEST</code>.</p>
<h2 data-sourcepos="227:1-227:25">Common Debugging Tasks</h2>
<h3 data-sourcepos="229:1-229:31">Check if a Member Can Login</h3>
<pre data-sourcepos="231:1-234:3"><code class="language-javascript">var member = getMemberByEmail(&quot;jane@example.com&quot;);
var active = isActiveMember(&quot;jane@example.com&quot;);  // Returns { isActive, status, message }
</code></pre>
<h3 data-sourcepos="236:1-236:28">Check Reservation Limits</h3>
<pre data-sourcepos="238:1-241:3"><code class="language-javascript">var limits = checkReservationLimits(&quot;HSH-2026-001&quot;, &quot;Tennis Court&quot;, new Date(), 1.5);
// Returns { allowed, isExcess, reason, hoursUsed, hoursLimit }
</code></pre>
<h3 data-sourcepos="243:1-243:21">View Session Data</h3>
<p data-sourcepos="245:1-245:89">In &quot;Sessions&quot; tab of GEA System Backend: check <code>active</code> status and <code>expires_at</code> timestamp</p>
<h3 data-sourcepos="247:1-247:21">Check Audit Trail</h3>
<p data-sourcepos="249:1-249:104">In &quot;Audit Log&quot; tab: filter by <code>user_email</code> or <code>target_id</code> to see all actions for a member or reservation</p>
<h2 data-sourcepos="251:1-251:32">File Size &amp; Performance Notes</h2>
<ul data-sourcepos="253:1-257:0">
<li data-sourcepos="253:1-253:96">No external dependencies (jQuery, Bootstrap, etc.) — uses vanilla JavaScript and Google APIs</li>
<li data-sourcepos="254:1-254:110">Sheets API calls are the bottleneck — use caching where possible (<code>getConfigValue()</code> caches per execution)</li>
<li data-sourcepos="255:1-255:65">Email sending via GmailApp (no rate limits for domain accounts)</li>
<li data-sourcepos="256:1-257:0">Session tokens: simple 64-character hex strings (no JWT complexity)</li>
</ul>
<h2 data-sourcepos="258:1-258:23">Known Issues &amp; TODOs</h2>
<p data-sourcepos="260:1-260:30">From Admin.html code comments:</p>
<ul data-sourcepos="261:1-265:0">
<li data-sourcepos="261:1-261:64">Dashboard counts are hardcoded instead of fetched from backend</li>
<li data-sourcepos="262:1-262:61">Reservation/member detail modals show fake data (hardcoded)</li>
<li data-sourcepos="263:1-263:68">Photo display not yet implemented (no Google Drive URL conversion)</li>
<li data-sourcepos="264:1-265:0">Member/reservation search is client-side only</li>
</ul>
<p data-sourcepos="266:1-266:31">From Portal.html code comments:</p>
<ul data-sourcepos="267:1-271:0">
<li data-sourcepos="267:1-267:70">Phone number integration incomplete (<code>initPhoneInputs()</code> not called)</li>
<li data-sourcepos="268:1-268:43">No real-time validation feedback on forms</li>
<li data-sourcepos="269:1-269:39">Guest list submission not implemented</li>
<li data-sourcepos="270:1-271:0">Photo upload not implemented</li>
</ul>
<h2 data-sourcepos="272:1-272:33">Deployment &amp; Go-Live Checklist</h2>
<ul data-sourcepos="274:1-283:0">
<li data-sourcepos="274:1-274:55"><input type="checkbox" disabled="" /> Delete test data (HSH-2026-TEST*, IND-2026-TEST*)</li>
<li data-sourcepos="275:1-275:65"><input type="checkbox" disabled="" /> Update email addresses in Config.gs (board, treasurer, RSO)</li>
<li data-sourcepos="276:1-276:63"><input type="checkbox" disabled="" /> Update logo/favicon URLs in Config.gs (must be shareable)</li>
<li data-sourcepos="277:1-277:86"><input type="checkbox" disabled="" /> Set up Google Apps Script time-driven triggers for nightly tasks and RSO summary</li>
<li data-sourcepos="278:1-278:104"><input type="checkbox" disabled="" /> Configure web app deployment: <strong>Deploy &gt; New Deployment &gt; Web App &gt; Execute as [service account]</strong></li>
<li data-sourcepos="279:1-279:40"><input type="checkbox" disabled="" /> Embed deployed URL in Google Sites</li>
<li data-sourcepos="280:1-280:60"><input type="checkbox" disabled="" /> Test login, reservations, and payment flows end-to-end</li>
<li data-sourcepos="281:1-281:68"><input type="checkbox" disabled="" /> Verify all email templates are active in &quot;Email Templates&quot; tab</li>
<li data-sourcepos="282:1-283:0"><input type="checkbox" disabled="" /> Remove <code>_setupTestPasswords()</code> function from Code.gs</li>
</ul>
<h2 data-sourcepos="284:1-284:22">Support &amp; Questions</h2>
<p data-sourcepos="286:1-286:27">For issues with the system:</p>
<ul data-sourcepos="287:1-290:36">
<li data-sourcepos="287:1-287:51">Check <strong>Audit Log</strong> tab for what changed and when</li>
<li data-sourcepos="288:1-288:57">Review <strong>Google Apps Script Executions</strong> tab for errors</li>
<li data-sourcepos="289:1-289:62">Run <code>testConfig()</code> to verify all spreadsheet IDs are correct</li>
<li data-sourcepos="290:1-290:36">Contact: <a href="mailto:treasurer@geabotswana.org">treasurer@geabotswana.org</a></li>
</ul>

    </article>
  </body>
</html>
